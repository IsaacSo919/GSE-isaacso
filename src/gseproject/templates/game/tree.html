
{% extends 'game/base_game_template.html' %}


{% block title %}Plant a Tree{% endblock %}

{% block content %}

{% load static %}
<style> 
    .countdown {
      position: fixed;
      top: 80px;
      right: 120px;
      background-color: gold;
      padding: 5px;
      border-radius: 5px;
      color: black;
    }

.center {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}
</style>
  
<img id="treeImage1" src="{% static 'images/seed.png' %}" alt="Seed">
<img id="treeImage2" src="{% static 'images/sprout.png' %}" alt="Sprout">
<img id="treeImage3" src="{% static 'images/sapling.png' %}" alt="Sapling">
<img id="treeImage4" src="{% static 'images/tree.png' %}" alt="Tree">
<button id="plantButton" class="btn btn-success">Plant</button>

<div class="countdown">
  Countdown: <span id="countdownTimer">10</span> seconds
</div>
       
<script>
 
let stage1 = 'static/images/seed.jpg';
let stage2 = 'static/images/sprout.jpg';
let stage3 = 'static/images/sapling.jpg';
let stage4 = 'static/images/tree.jpg';

let stages = [stage1, stage2, stage3, stage4];
let currentStage = 0;
let cherries = 0;
let cooldownDuration = 3600000; // 1 hour in milliseconds, change for testing if needed
let plantingInProgress = false; // Flag to track if planting process is in progress

window.onload = function() {
    // Hide all images initially
    for (let i = 1; i <= stages.length; i++) {
        document.getElementById('treeImage' + i).style.display = 'none';
    }

    document.getElementById('plantButton').addEventListener('click', plantTree);
    updateCherriesDisplay();
    checkCooldown();
};

function plantTree() {
    if (plantingInProgress) return; // If planting is already in progress, exit

    // Start planting process
    plantingInProgress = true;
    countdownTimer(cooldownDuration / 1000); // Start countdown timer

    // Display seed image initially
    document.getElementById('treeImage1').style.display = 'block';

    // Start growing stages after button click
    let interval = setInterval(() => {
        if (currentStage < stages.length - 1) {
            currentStage++;
            // Hide all images except the current stage
            for (let i = 1; i <= stages.length; i++) {
                document.getElementById('treeImage' + i).style.display = 'none';
            }
            // Display the current stage image
            document.getElementById('treeImage' + (currentStage + 1)).style.display = 'block';
        } else {
            clearInterval(interval); // Stop interval when tree is fully grown
            cherries += 10; // Bonus cherries for growing a tree
            alert('Congratulations! You have grown a full tree and earned 10 bonus cherries!');
            plantingInProgress = false; // Reset planting flag
            checkCooldown(); // Check cooldown for next planting
        }
    }, 2000); // Change stage every 2 seconds
}

function updateCherriesDisplay() {
  document.getElementById('cherriesCount').innerText = `Cherries: ${cherries}`;
}

function checkCooldown() {
    let lastPlantedTime = localStorage.getItem('lastPlantedTime');
    if (lastPlantedTime) {
        let timePassed = new Date().getTime() - lastPlantedTime;
        if (timePassed < cooldownDuration) {
            // Disable plant button during cooldown
            document.getElementById('plantButton').disabled = true;
            // Start countdown timer
            countdownTimer((cooldownDuration - timePassed) / 1000);
        } else {
            // If cooldown ended, enable plant button
            document.getElementById('plantButton').disabled = false;
        }
    }
}

function countdownTimer(seconds) {
    // Display countdown timer
    let timerElement = document.getElementById('countdownTimer');
    timerElement.textContent = `Cooldown ends in: ${formatTime(seconds)}`;
    
    // Update timer every second
    let countdown = setInterval(() => {
        seconds--;
        timerElement.textContent = `Cooldown ends in: ${formatTime(seconds)}`;
        if (seconds <= 0) {
            clearInterval(countdown); // Stop countdown when timer reaches zero
            document.getElementById('plantButton').disabled = false; // Enable plant button
            timerElement.textContent = ''; // Clear timer display
        }
    }, 1000);
}

function formatTime(seconds) {
    // Format time as minutes:seconds
    let minutes = Math.floor(seconds / 60);
    let remainingSeconds = seconds % 60;
    return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}
</script>


{% endblock %}
